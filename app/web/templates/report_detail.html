{% extends "base.html" %}
{% block title %}{{ report.title }} - 政策情报助手{% endblock %}

{% block content %}
<div class="flex items-center gap-3 mb-6">
  <a href="/reports" class="text-gray-400 hover:text-gray-600">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
  </a>
  <div>
    <h2 class="text-2xl font-bold text-gray-900">{{ report.title }}</h2>
    <p class="text-sm text-gray-400">{{ report.generated_at }}</p>
  </div>
</div>

<div id="sourceNav" class="card mb-4" style="display:none">
  <div class="flex flex-wrap items-center gap-2">
    <span class="text-sm font-medium text-gray-600">源导航:</span>
    <div id="sourceNavBtns" class="flex flex-wrap gap-2"></div>
  </div>
</div>

<div class="card">
  <div class="prose max-w-none" id="reportContent">
    {{ report.content_html | safe }}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const content = document.getElementById('reportContent');
  const h2s = content.querySelectorAll('h2');
  if (h2s.length <= 1) return;

  const nav = document.getElementById('sourceNav');
  const btnsContainer = document.getElementById('sourceNavBtns');
  nav.style.display = '';

  h2s.forEach((h2, i) => {
    const id = 'source-section-' + i;
    h2.id = id;
    const btn = document.createElement('button');
    btn.className = 'btn btn-secondary btn-sm';
    btn.textContent = h2.textContent;
    btn.onclick = function() {
      document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
    };
    btnsContainer.appendChild(btn);
  });
});
</script>
{% endblock %}
